<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Animals Park AR</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <script src="https://unpkg.com/aframe-gesture-detector@3.3.0/dist/aframe-gesture-detector.min.js"></script>

    <script>
      AFRAME.registerComponent("rotation-reader", {
        schema: { default: 1 },
        init: function () {
          this.el.addEventListener("dragmove", (event) => {
            const rotation = this.el.getAttribute("rotation");
            this.el.setAttribute("rotation", {
              x: rotation.x,
              y: rotation.y + event.detail.deltaX * 0.5,
              z: rotation.z,
            });
          });
        },
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs>
      <!-- Assets -->
      <a-assets>
        <!-- Models -->
        <a-asset-item id="elephant-model"src="assets/models/elephant.glb"></a-asset-item>
        <a-asset-item id="tiger-model" src="assets/models/tiger.glb"></a-asset-item>
        <a-asset-item id="rhino-model" src="assets/models/rhino.glb"></a-asset-item>
        <a-asset-item id="cow-model" src="assets/models/cow.glb"></a-asset-item>

        <!-- Sounds -->
        <audio id="elephant-sound" src="assets/sounds/elephant.mp3" preload="auto"></audio>
        <audio id="tiger-sound" src="assets/sounds/tiger.mp3" preload="auto"></audio>
        <audio id="rhino-sound" src="assets/sounds/rhino.mp3" preload="auto"></audio>
        <audio id="cow-sound" src="assets/sounds/cow.mp3" preload="auto"></audio>
      </a-assets>

      <!-- Elephant -->
      <a-marker type="pattern" url="markers/elephant.patt">
        <a-entity
          gltf-model="#elephant-model"
          scale="0.5 0.5 0.5"
          position="0 0 0"
          gesture-detector
          rotation-reader
        ></a-entity>
        <a-entity
          id="elephantSoundEntity"
          sound="src: #elephant-sound"
        ></a-entity>
      </a-marker>

      <!-- Tiger -->
      <a-marker type="pattern" url="markers/tiger.patt">
        <a-entity
          gltf-model="#tiger-model"
          scale="0.5 0.5 0.5"
          position="0 0 0"
          gesture-detector
          rotation-reader
        ></a-entity>
        <a-entity id="tigerSoundEntity" sound="src: #tiger-sound"></a-entity>
      </a-marker>

      <!-- rhino -->
      <a-marker type="pattern" url="markers/rhino.patt">
        <a-entity
          gltf-model="#rhino-model"
          scale="0.5 0.5 0.5"
          position="0 0 0"
          gesture-detector
          rotation-reader
        ></a-entity>
        <a-entity id="rhinoSoundEntity" sound="src: #rhino-sound"></a-entity>
      </a-marker>

      <!-- cow -->
      <a-marker type="pattern" url="markers/cow.patt">
        <a-entity
          gltf-model="#cow-model"
          scale="0.5 0.5 0.5"
          position="0 0 0"
          gesture-detector
          rotation-reader
        ></a-entity>
        <a-entity id="cowSoundEntity" sound="src: #cow-sound"></a-entity>
      </a-marker>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", () => {
          document.querySelectorAll("audio").forEach((audio) => {
            audio
              .play()
              .then(() => {
                audio.pause();
                audio.currentTime = 0;
              })
              .catch(() => {
                console.log("User interaction needed for sound");
              });
          });
        });

        const markerMap = {
          "elephant.patt": "elephantSoundEntity",
          "tiger.patt": "tigerSoundEntity",
          "rhino.patt": "rhinoSoundEntity",
          "cow.patt": "cowSoundEntity",
        };

        document.querySelectorAll("a-marker").forEach((marker) => {
          marker.addEventListener("markerFound", () => {
            const url = marker.getAttribute("url");
            const fileName = url.split("/").pop();
            const soundEntityId = markerMap[fileName];
            const soundEntity = document.getElementById(soundEntityId);
            if (soundEntity && soundEntity.components.sound) {
              soundEntity.components.sound.playSound();
            }
          });
        });
      });
    </script>
  </body>
</html>
